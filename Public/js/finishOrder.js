/* SVN.committedRevision=1246193 */
var countDwonSecond=0,list_w=[];jQuery(document).ready(function(){jQuery.ajax({type:"post",async:false,url:"/order/isAjaxOrderFinishFunctionByConfig.do",success:function(b){var a=b.result;if(a==1){lazyloadOrderFinshOrderInfo();lazyloadOrderAddressEdit();lazyloadOrderFinshAds();loadP4pInfo()}}});payResult.main();if($(".mod_gift").length>0){lazyLoadTrialInfo();lazyLoadGbyInfo()}if($("#timeToDeadLineFastPay").length>0){jQuery("#timeToDeadLineFastPay").bind("click",sendMsgFastPay)}$.getJSON(URLPrefix.central+"/cart/info/totalNum.do?callback=?",function(a){});if($("#payFlag").length){gotracker("2",$("#payFlag").val())}});function lazyloadOrderFinshAds(){var a=jQuery("#finish_order_code").val();jQuery.ajax({type:"post",async:false,url:"/order/finishOrderPageAds.do?orderCode="+a,dataType:"text",success:function(b){jQuery("#order_finish_content").append(b)
}})}function lazyloadOrderFinshOrderInfo(){var a=jQuery("#finish_order_code").val();var b=jQuery("#finish_order_paymenttype").val();jQuery.ajax({type:"post",async:false,url:"/order/finishOrderPageInfo.do?orderCode="+a,dataType:"text",success:function(c){jQuery("#payment_type_"+b).append(c)}})}function lazyloadOrderAddressEdit(){var b=jQuery("#finish_order_code").val();var d=jQuery("#bukai_flag").val();var a=jQuery("#invoice_flag").val();var c=jQuery(".pay_num .info");jQuery.ajax({type:"post",url:"/order/finishOrderAddressEdit.do?orderCode="+b,success:function(g){var e=g.result;if(d==0){if(e.addressEditable){var f="";if(e.orderPaymentSignal==1&&!e.isAlreadyVerify){f+=' <input type="hidden" id="isHaveVerify_'+e.orderId+'" value="0">';f+=" <a href=\"javascript:void(0)\" onclick=\"gotracker('2','MY_ORDERCOMPLETION_EDITADDRESS','0');alreadyPayOrderEditAddreValidate("+e.orderId+');" class="aBlu">修改收货地址</a>'
}else{f+=" <a href=\"javascript:void(0)\" onclick=\"gotracker('2','MY_ORDERCOMPLETION_EDITADDRESS','0');popWinEditOrderDiv("+e.orderId+');" class="aBlu">修改收货地址</a>'}c.append(f)}}if(d==1&&a==1){var f="";f+='<div id="btn_edit_info" class="edit_info">';f+='<h4 style="display: block;"><i class="icon_slect"></i>修改订单</h4>';f+='<ul style="display: none;">';if(e.addressEditable){f+="<li>";if(e.orderPaymentSignal==1&&!e.isAlreadyVerify){f+=' <input type="hidden" id="isHaveVerify_'+e.orderId+'" value="0">';f+=" <a href=\"javascript:void(0)\" onclick=\"gotracker('2','MY_ORDERCOMPLETION_EDITADDRESS','0');alreadyPayOrderEditAddreValidate("+e.orderId+');" class="aBlu">修改收货地址</a>'}else{f+=" <a href=\"javascript:void(0)\" onclick=\"gotracker('2','MY_ORDERCOMPLETION_EDITADDRESS','0');popWinEditOrderDiv("+e.orderId+');" class="aBlu">修改收货地址</a>'
}f+="</li>"}if(!e.isNeedPay){f+=' <li><a href="/invoice/invoiceApply.do" class="aBlu" target="_blank" onclick="addTrackPositionToCookie(\'2\', \'MY_ORDERCOMPLETION_REINVOCIE\');">补开发票</a></li>'}else{f+=' <li><a class="link_none" href="javascript:void(0);">补开发票 <span>您可在支付成功后补开发票</span></a></li>'}f+="</ul></div>";c.after(f)}}})}var payResult={gift:function(){function a(c,b){c.hover(function(){$(this).addClass(b)},function(){$(this).removeClass(b)})}a($(".mod_gift .test_pro"),"test_pro_hover");a($(".mod_gift .send_ticet"),"send_ticet_hover");a($(".mod_gift .surprise"),"surprise_hover")},payBox:function(){$(".mod_pay_result #btn_addr,.mod_pay_result .slide_box .btn_slide_down").toggle(function(){$(".mod_pay_result .slide_box .btn_slide_down").addClass("btn_slide_up").text("收起");$(".mod_pay_result .cont_wrap").slideDown()
},function(){$(".mod_pay_result .slide_box .btn_slide_down").removeClass("btn_slide_up").text("展开");$(".mod_pay_result .cont_wrap").slideUp()})},payBoxUp:function(){$(".mod_pay_result #btn_addr,.mod_pay_result .slide_box .btn_slide_up").toggle(function(){$(".mod_pay_result .slide_box .btn_slide_down").removeClass("btn_slide_up").text("展开");$(".mod_pay_result .cont_wrap").slideUp()},function(){$(".mod_pay_result .slide_box .btn_slide_down").addClass("btn_slide_up").text("收起");$(".mod_pay_result .cont_wrap").slideDown()})},changeBank:function(){if($("#pay_bank_box").length!==0){$(".mod_pay_result #pay_bank_box").click(function(){$("._payOrderBoxMsg").hide();$("#pay_bank_box").slideUp();$(".mod_pay_result .all_banks_box").slideDown(0)});function a(){var c=$(this).siblings("img").eq(0).attr("src");
var b=$(this).attr("data-tips");$(".mod_pay_result .all_banks_box").slideUp();$(".mod_pay_result .pay_bank img").eq(0).attr("src",c);$("#pay_bank_box").slideDown();$("#bankDataTips").text(b)}$(".mod_pay_result .pay_list input").change(a);$(".mod_pay_result .all_banks_box .btn_slide_up").click(a)}},editInfo:function(){$("#btn_edit_info").hover(function(){$(this).find("h4").hide();$(this).find("ul").show()},function(){$(this).find("h4").show();$(this).find("ul").hide()})},closePop:function(){$(".mod_popup_pay .mod_popup_pay_close").click(function(){$(this).parents(".mod_popup_pay").hide();$("#mask").hide()})},switchProduct:function(){$(".switch_box").each(function(){var c=0;var b=$(this).find(".pro_item");var a=b.length;$(this).find(".btn_pre").click(function(){c--;if(c<0){c=a-1}b.hide().eq(c).show()
});$(this).find(".btn_next").click(function(){c++;if(c>a-1){c=0}b.hide().eq(c).show()})})},scaleTwoCode:function(){var a=$(".two_dimensional_code");a.delegate(".code_bo_item","mouseenter",function(){var c=$(this),b=$(this).parent().parent().index(".two_dimensional_code"),d=$(this).index(".code_bo_item");a.eq(b).find(".code_font2").removeClass("code_font_hid").stop().animate({opacity:"0.23"});a.eq(b).find(".conde_bo_f").css({"padding-left":"0","padding-right":"0"});c.find(".code_font2").stop().animate({opacity:"1"}).addClass("code_font_hid");if(d%2==0){c.parent().find(".conde_bo_f").stop().animate({"padding-left":"30px"})}else{c.parent().find(".conde_bo_f").stop().animate({"padding-right":"30px"})}})},showPopup:function(a){var c=a.width();var e=a.height();var d=$(window).scrollTop();var b=$(window).height();
if($.browser.msie&&parseInt($.browser.version)<=6){a.css({left:"50%",marginLeft:"-"+c/2+"px",top:(b-e)/2+d+"px",position:"absolute",zIndex:"99999"});$(window).scroll(function(){a.css({top:(b-e)/2+$(window).scrollTop()+"px"})})}else{a.css({left:"50%",marginLeft:"-"+c/2+"px",top:(b-e)/2-40+"px",position:"fixed",zIndex:"99999"})}a.show()},closePopup:function(a,b){a.bind("click",function(){$(this).parents(b).hide();$("#mask").hide()})},changePay:function(){$(".all_banks_box input").change(function(a){if($(this).parents(".fast_pay").length>0){$(this).parents("li").siblings("li").removeClass("current");$(this).parents("li").addClass("current")}else{$(".all_banks_box .fast_pay li").removeClass("current")}})},moreSlogan:function(){$(".fast_pay .btn_more").click(function(){this.isOpen=!this.isOpen;if(this.isOpen){$(this).addClass("on").find("em").text("收起更多")
}else{$(this).removeClass("on").find("em").text("展开更多")}a(this.isOpen)});function a(b){$(".fast_pay .pay_wrap li").each(function(c){if(b){$(this).show(300)}else{if(c>1){$(this).hide(300)}}})}},main:function(){var c=$("#bank_logo").attr("confirmGatewayCode");var b=$("input:radio[name='pay_bank1']:checked");var a=b.attr("confirmGatewayCode");payResult.gift();payResult.payBox();payResult.payBoxUp();payResult.changeBank();payResult.editInfo();payResult.closePop();payResult.switchProduct();payResult.scaleTwoCode();payResult.changePay();payResult.moreSlogan()}};function loadP4pInfo(){if($("#pUrl").length){var b=$("#pUrl").val();if(b.length>1){var a=URLPrefix.ad_ydt_yhd+b;$.getJSON(a+"&callback=?",function(k){if(k.status==1){if(k.value&&k.value.sourceList){var h=k.value.sourceList;if(h.length>4){$(".mod_hot_sale").show();
if(k.value.extField1){$(".mod_hot_sale .title_bar a").attr("href",k.value.extField1)}else{$(".mod_hot_sale .title_bar a").text("")}var d="";var c=0;for(var f=0;f<h.length;f++){var j=h[f];var g;if(j.screenType==1){g=j.wideScreenImgUrl}else{g=j.commonScreenImgUrl}var e="<li><p class='pro_img'><a href='"+j.landingPage+"'><img alt='"+j.productName+"' src='"+g+"'></a></p>";e=e+"<p class='pro_name'><a href='"+j.landingPage+"'>"+j.productName+"</a></p>";e=e+"<p class='pro_price'>¥"+j.currentPrice+"</p></li>";$(".mod_hot_sale .content ul").append(e);if(j.biddingAdType>0&&j.biddingAdType<=3){d=d+","+j.ref.substring(3);c=1}}if(d.length>0&&c==1){d=d.substring(1);recordTrackInfoWithType(1,d,"ad.dolphin.bidding")}}}}})}}}function lazyLoadTrialInfo(){var a=$("#orderId").val();jQuery.ajax({type:"post",url:"/order/getTrialInfo.do",data:"orderId="+a+"&t="+new Date(),success:function(b){$("#trialCoupon").html(b);
if($("#trialCoupon .cont_box").length>0){$("#trialCoupon").addClass("test_pro").addClass("switch_box")}payResult.main()}})}function lazyLoadGbyInfo(){var a=$("#orderId").val();jQuery.ajax({type:"post",url:"/order/getGbyInfo.do",data:"orderId="+a+"&t="+new Date(),success:function(b){$("#gbyCoupon").html(b);if($("#gbyCoupon .cont_box").length>0){$("#gbyCoupon").addClass("surprise").addClass("switch_box")}payResult.main()}})}function changePayGateway(c,e,f,a){$("._payOrderBoxMsg").show();var b="/order/changePaymentForFinishOrder.do?gatewayCode="+c+"&orderId="+e+"&paySignId="+f+"&paySignNo="+a;var g=$("#pay_shaoma_input_alipayPayId").val();var h=$("#pay_shaoma_input_alipayPayCode").val();var d=$("#pay_shaoma_input_url").val();var i=$("#pay_shaoma_input_url").attr("saomaSign");jQuery.getJSON(b,function(j){if(j){if(j.rCode==1){$("input:radio[name='pay_bank1']").attr("checked",false);
var k;if(f!=""&&f>0){k=$("#bank_a_"+c+"_"+f);$("#bank_logo").attr("confirmPaySignId",k.attr("confirmPaySignId"));$("#bank_logo").attr("signNo",k.attr("signNo"))}else{k=$("#chooseG_"+c);$("#bank_logo").attr("confirmPaySignId","");$("#bank_logo").attr("signNo","")}k.attr("checked","checked");$("#bank_logo").attr("src",k.attr("gatewayPic"));$("#bank_logo").attr("title",k.attr("gatewayName"));$("#bank_logo").attr("confirmGatewayCode",k.attr("confirmGatewayCode"));$("#bank_logo").attr("bankType",k.attr("bankType"));$("#bankDataTips").text(k.attr("gatewayDesc"));$(".mod_pay_result .all_banks_box").slideUp();$(".mod_pay_result #pay_bank_box").slideDown(0);if(c&&f==""&&c==h){if($("#pay_shaoma_iframe").html()==""&&i==1){$("#pay_shaoma_iframe").html("<iframe scrolling='no' frameborder='0' src='"+d+"'></iframe>")
}$("#pay_shaoma_div").show();$("#pay_normal_div").hide()}else{$("#pay_shaoma_div").hide();$("#pay_normal_div").show()}paymentGatewaySaved=true}else{$(".mod_pay_result .all_banks_box").slideUp();$(".mod_pay_result #pay_bank_box").slideDown(0);jQuery("#err_popwin").html("订单暂时无法编辑，请稍后再试！");yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"})}}})}function choosePayMethod(t){var b=$("input:radio[name='pay_bank7']:checked");var f=$("input:radio[name='pay_bank3']:checked");var g=b.attr("signNo");var r=b.attr("gatewayName");var k=$(".pay_other").attr("isCreditCardEbank");var c=$(".pay_other").attr("isDebitCardDirectPay");var l=$(".pay_other").attr("isDebitCardEbank");var q=$(".pay_other").attr("isCreditCardDirectPay");var w=$("#popChangeCard2").attr("bankCode").toUpperCase();var p=$("#popChangeCard2").attr("bankCode");
var j=$("#popChangeCard2").attr("orderId");var h=$("#popChangeCard2").attr("orderCode");var i=$("#popChangeCard2").attr("gatewayId");var n=$("#popChangeCard2").attr("preType");var m=b.attr("id");var u=b.val();var v=f.attr("id");var d=f.val();if(typeof(g)=="undefined"||g==""){var a=b.attr("bindPay");if(typeof(a)!="undefined"){var o;$(".payWensong").each(function(){if(a.indexOf($(this).val())<0){$(this).removeAttr("checked","checked");$(this).find(".testWensong").addClass("canNoUse");$(this).attr("disabled","disabled");o=$(this).attr("id")}else{$(this).removeAttr("disabled");$(this).removeAttr("title");$(".testWensong").removeClass("canNoUse");$(".sloganA").hide()}});if(typeof(o)!="undefined"){$(".pay_kind").find("label").each(function(){if(o==$(this).attr("for")){$(this).find(".testWensong").addClass("canNoUse");
$(this).attr("title","该卡类型暂不支持快捷支付");$(this).find(".sloganA").show()}else{$(this).find(".sloganA").hide()}})}}var e=f.attr("bindCard");if(typeof(e)!="undefined"){var s;$(".cardWensong").each(function(){if(e.indexOf($(this).val())<0){$(this).removeAttr("checked","checked");$(this).find(".testWensong").addClass("canNoUse");$(this).attr("disabled","disabled");s=$(this).attr("id")}else{$(this).removeAttr("disabled");$(this).removeAttr("title")}});if(typeof(s)!="undefined"){$(".kind_card").find("label").each(function(){if(s==$(this).attr("for")){$(this).find(".testWensong").addClass("canNoUse");$(this).attr("title","该卡类型暂不支持快捷支付");$(this).find(".sloganA").show()}else{$(this).find(".sloganA").hide()}})}}if(typeof(t)!="undefined"&&t=="go"){if(typeof(m)=="undefined"||typeof(v)=="undefined"){if(typeof(b)=="undefined"){alert("请选择支付卡信息");
return}else{alert("请选择支付方式信息");return}}if(d=="FAST_PAY"){$(".mod_popup_pay").show();if($("#popChageCard2")){$("#popfastPay").remove()}window.open("/gateway/selectFastPay.do?bankCardType="+u+"&selectBankCode="+w+"&orderCode="+h+"&generalSignType=2")}else{$(".mod_popup_pay").show();$("#mask").show();if($("#popChageCard2")){$("#popfastPay").remove()}window.open("/gateway/select_gateway.do?orderId="+j+"&preType="+n+"&gatewayCode="+p)}}}else{var m=b.attr("id");if(typeof(t)!="undefined"&&t=="go"){openFastPayUrl(g,j,h,w)}}}function initSelect(){var a=$("input:radio[name='pay_bank7']:checked");var b=$("input:radio[name='pay_bank3']:checked");var c=a.attr("bindPay");$(".sloganA").hide();if(typeof(c)!="undefined"){$(".payWensong").each(function(){if(c.indexOf($(this).val())<0){$(this).removeAttr("checked","checked");
$(this).attr("disabled","disabled");var d=$(this).attr("id");$("label").each(function(){if($(this).attr("for")==d){$(this).attr("title","该卡类型暂不支持快捷支付");$(this).find(".sloganA").show();$(this).find(".testWensong").addClass("canNoUse")}else{$(this).find(".sloganA").hide();$(this).find(".testWensong").removeClass("canNoUse")}})}else{$(this).removeAttr("disabled");$(this).removeAttr("title");$(this).attr("checked",true)}})}}function doPayV2(d,j,f){var l=$("input:radio[name='pay_bank1']:checked");var h=l.attr("id");if(typeof(h)=="undefined"){jQuery("#err_popwin").html("选择支付方式！");yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}var k=$("#"+h).attr("confirmGatewayCode");var b=$("#bank_logo").attr("confirmGatewayCode");if(k!=b){var e=$("#"+h).attr("confirmPaySignId");var c=$("#"+h).attr("confirmGatewayCode").toUpperCase();
var a=$("#"+h).attr("signNo");var i=$("#"+h).attr("bankType");b=k}else{var e=$("#bank_logo").attr("confirmPaySignId");var c=$("#bank_logo").attr("confirmGatewayCode").toUpperCase();var a=$("#bank_logo").attr("signNo");var i=$("#bank_logo").attr("bankType")}if(b==""){jQuery("#err_popwin").html("订单信息错误，请稍后再试！");yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}if(e!=""&&e>0){openFastPayUrl(a,d,f,c)}else{if(i==1){if(b=="fund"){$(".mod_popup_pay").show();$("#mask").show();window.open("https://my.yhd.com/order/select_fundPayMethod.do?orderCode="+f+"&orderId="+d)}else{$(".mod_popup_pay").show();$("#mask").show();window.open("/gateway/select_gateway.do?orderId="+d+"&preType="+j+"&gatewayCode="+b)}}else{var g="/order/popWinFastPay.do?orderCode="+f+"&orderId="+d+"&paySignId="+e+"&selectBankCode="+b;
if($("#popChageCard2")){$("#popfastPay").remove()}jQuery.ajax({type:"post",url:g,success:function(m){$("body").append(m);payResult.showPopup($("#popChangeCard2"));payResult.closePopup($(".mod_change_card .tit_bar button"),".mod_change_card");payResult.closePopup($(".mod_change_card .btn_return"),".mod_change_card");$("#mask").show();initSelect();$("#popChangeCard2").find(".btn_box .btn_smt").unbind("click").bind("click",function(){choosePayMethod("go")})}})}}}function confirmFastPay(){var c=$("#verifyCode").val();var a=$("#finish_order_code").val();var b=$("#paySignNo").val();var d="/order/produceSign.do?orderCode="+a+"&paySignNo="+b+"&verifyCode="+c+"&generalSignType=1";jQuery.getJSON(d,function(f){if(f&&f.code==1){var e=f.fastPayUrl;jQuery.getJSON(e,function(g){if(g){if(g.state=="success"){window.location="/gateway/return.do?orderCode="+a+"&paymentStatus=isPaid"
}else{jQuery("#err_popwin").html(g.message);yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}}})}else{jQuery("#err_popwin").html("订单暂时无法支付，请稍后再试！");yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}})}function sendMsgFastPay(){deadLineFastPay=60;var a=$("#orderCode").val();var b=$("#paySignNo").val();var c="/order/produceSign.do?orderCode="+a+"&paySignNo="+b+"&generalSignType=0";jQuery.getJSON(c,function(e){if(e&&e.code==1){var d=e.fastPayUrl;jQuery.getJSON(d,function(f){if(f){if(f.state=="success"){timeToDeadLineFastPay();jQuery("#timeToDeadLineFastPay").unbind("click",sendMsgFastPay)}else{jQuery("#err_popwin").html(f.message);yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}}})}else{jQuery("#err_popwin").html("订单暂时无法支付，请稍后再试！");
yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}})}var deadLineFastPay=60;function timeToDeadLineFastPay(){if(jQuery(".get_code").length>=1){if(deadLineFastPay!=0){jQuery("#timeToDeadLineFastPay").attr("disabled","disabled");jQuery("#timeToDeadLineFastPay").html("<span>"+deadLineFastPay+"</span>秒后重新获取");deadLineFastPay--;setTimeout("timeToDeadLineFastPay()",1000)}else{jQuery("#timeToDeadLineFastPay").attr("disabled","");jQuery("#timeToDeadLineFastPay").html("重新发送验证码");jQuery("#timeToDeadLineFastPay").bind("click",sendMsgFastPay)}}}function openFastPayUrl(d,a,b,c){if(d!=null&&a!=null&&b!=null){if($("#popChageCard2")){$("#popfastPay").remove()}$("#mask").show();$(".mod_popup_pay").show();window.open("/order/select_fastPayMethod.do?orderCode="+b+"&orderId="+a+"&signNo="+d+"&bankCode="+c)
}else{jQuery("#err_popwin").html("订单信息错误，请稍后再试！");yhdLib.popwin({poptitle:"温馨提示",popcontent:".error_info_show"});return}}function choosePayNextForFinishOrder(a){jQuery("#pay_wait_winClose").click();choosePayForFinishOrder(a)}function displayMask(){var a=document.body.clientWidth;var b=document.body.clientHeight;jQuery("<div id='maskDiv'/>").width(a).height(b+document.body.scrollHeight/8).css("background","#333").css("position","absolute").css("top","0px").css("left","0px").css("opacity","0.5").css("filter","Alpha(Opacity=50)").css("z-index",390000).appendTo("body").fadeIn(200)}function popClose(a){jQuery(".popGeneral_address").hide();jQuery(".popGeneral_address .aptab_center_address").empty();jQuery("#maskDiv").remove()}function addBookmark(b,a){if(window.sidebar){window.sidebar.addPanel(b,a,"")
}else{if(document.all){window.external.AddFavorite(a,b)}else{if(window.opera&&window.print){return true}}}}function bindEmail(){var a="/order/popFinishOrderEmail.do";jQuery.ajax({type:"post",url:a,success:function(e){if(e){yhdLib.popwin({poptitle:"输入邮箱",popcontentstr:e});var d=$(".mod_check_email .email_input");var b=$(".mod_check_email .tips_erro");var c=/^\w[\w\$\^\(\)\[\]\{\}\.\-\+,]{0,100}@([a-zA-Z0-9][\w\-]*\.)+[a-zA-Z]{2,6}$/;$(".btn_smt").click(function(){if($.trim(d.val())==""){d.addClass("input_erro");b.show();b.text("请输入邮箱地址");return false}else{if(!c.test(d.val())){d.addClass("input_erro");b.show();b.text("您输入的邮箱格式不正确");return false}else{var f="/order/saveFinishOrderEmail.do?callback=?";var g="userEmail="+d.val();jQuery.getJSON(f,g,function(h){if(h&&h.code){if(h.code==0){$(".mod_check_email").html("<p>系统繁忙，请稍后再试。</p>");
setTimeout(function(){window.location.reload()},3000)}else{if(h.code==1){$(".mod_check_email").html("<p class='succ_tips'>您的订单详情将以邮件的形式发送给您。</p>");setTimeout(function(){window.location.reload()},3000)}else{if(h.code==2){d.addClass("input_erro");b.show();b.text("请输入邮箱地址")}else{if(h.code==3){d.addClass("input_erro");b.show();b.text("您输入的邮箱格式不正确")}else{if(h.code==4){d.addClass("input_erro");b.show();b.text("您输入的邮箱已经存在，请换个邮箱")}else{$(".mod_check_email").html("<p>系统繁忙，请稍后再试。</p>");setTimeout(function(){window.location.reload()},3000)}}}}}}})}}return false});d.focus(function(){d.removeClass("input_erro");b.hide()});$(".popwinClose").click(function(){yhdLib.popclose()})}}})};function chooseAddrCopyToOrder(h){jQuery("#editOrderAddr_pop_ReceiverName").val(jQuery("#editAddress_popwin_receiverName_"+h).html());jQuery("#editOrderAddr_pop_Address").val(jQuery("#editAddress_popwin_address_"+h).html());jQuery("#editOrderAddr_pop_mobile").val(jQuery("#editAddress_popwin_mobil_"+h).val());jQuery("#editOrderAddr_pop_phone").val(jQuery("#editAddress_popwin_phone_"+h).val());var e=jQuery("#editAddress_popwin_countyName_"+h).val();var f=jQuery("#editOrderAddr_pop_countyId option").length;for(var g=0;g<f;g++){if(jQuery("#editOrderAddr_pop_countyId").get(0).options[g].text==e){jQuery("#editOrderAddr_pop_countyId").get(0).options[g].selected=true;break}}chooseNew()}function chooseAddress(){jQuery("#chooseAddress").addClass("current");jQuery("#chooseAddressDiv").show();jQuery("#chooseNew").removeClass("current");
jQuery("#chooseNewDiv").hide()}function chooseNew(){jQuery("#chooseNew").addClass("current");jQuery("#chooseNewDiv").show();jQuery("#chooseAddress").removeClass("current");jQuery("#chooseAddressDiv").hide()}function chooseExistAddress(b){jQuery(".already_address_div").removeClass("select_li");jQuery(b).addClass("select_li")}function cancelSaveAddressAndUnlockOrder(d){var e=getOrderVersionPara(d);var f="/order/unLockOrder.do";jQuery.ajax({type:"post",url:f,data:e,complete:function(a){}})}function getOrderVersionPara(h){var e="orderId="+h+"&versionNo="+jQuery("#editAddress_popwin_versionNo").val();var f=jQuery("input[id^=editAddress_popwin_subVersionNo_]");if(f&&f.length>0){var g=jQuery("input[id^=editAddress_popwin_subVersionNo_]").map(function(){return"subVersionNos="+jQuery(this).val()}).get().join("&");
e=e+"&"+g}return e}function saveOrderAddressUseBook(j){var i=jQuery(".select_li").attr("addId");var k=jQuery("#editOrderAddr_pop_address34Editable").val();var l=0;if(k=="true"){l=1}var g=getOrderVersionPara(j);g+="&addressBookId="+i+"&isEdit34AddreBook="+l;var h="/order/editOrderSaveAddrUserAddrBook.do";jQuery.ajax({type:"post",url:h,data:g,success:function(a){if(a==1){var b=jQuery("#editAddress_popwin_succseTest").val();jQuery("#editAddress_popwin_ResultText").html(b)}else{if(a==2){unlockOrderAddress(j,g);jQuery("#editAddress_popwin_ResultText").html("运费不同,暂无法修改，您可联系客服热线或尝试取消订单重下，谢谢支持！")}else{if(a==3){unlockOrderAddress(j,g);jQuery("#editAddress_popwin_ResultText").html("不支持当前的配送服务，暂无法修改，您可联系客服热线或尝试取消订单重下，谢谢支持！")}else{if(a==4){unlockOrderAddress(j,g);jQuery("#editAddress_popwin_ResultText").html("不支持当前的支付服务，暂无法修改，您可联系客服热线或尝试取消订单重下，谢谢支持！")
}else{unlockOrderAddress(j,g);jQuery("#editAddress_popwin_ResultText").html("系统异常，请重试！")}}}}jQuery(".popGeneral_address").hide();yhdLib.popwin({popcontentstr:jQuery("#editAddress_popwin_succseDiv").html()});setTimeout(function(){window.location.reload()},3000)}})}function saveOrderAddressUseNew(D){clearAddressDes();var A=jQuery("#editOrderAddr_pop_address34Editable").val();var t=jQuery("#editOrderAddr_pop_orderPaySign").val();var C=jQuery("#editOrderAddr_pop_countyId").val();var s=jQuery("#editOrderAddr_pop_countyId").find("option:selected").text();var v=jQuery("#editOrderAddr_pop_provinceName").val();var u=jQuery("#editOrderAddr_pop_cityName").val();if(A=="true"){if(!C||C==-1||!v||!u||!s){jQuery("#editOrderAddr_pop_postCodeNull").show();return}}var q=jQuery("#editOrderAddr_pop_Address").val();
var y=jQuery("#editOrderAddr_pop_ReceiverName").val();var E=jQuery("#editOrderAddr_pop_mobile").val();var w=jQuery("#editOrderAddr_pop_phone").val();var F="";var B=jQuery.trim(v)+jQuery.trim(u)+jQuery.trim(s);if(!validateAddressPara(y,q,E,w,B,t)){return}F="addressVo.receiverName="+encodeURIComponent(y);F+="&addressVo.address="+encodeURIComponent(q);F+="&addressVo.phone="+w;F+="&addressVo.mobil="+E;F+="&orderPaySign="+t;F+="&orderId="+D;if(A=="true"){F=F+"&addressVo.countyId="+C+"&addressVo.countyName="+encodeURIComponent(jQuery.trim(s))+"&addressVo.provinceName="+encodeURIComponent(jQuery.trim(v))+"&addressVo.cityName="+encodeURIComponent(jQuery.trim(u))}F=F+"&versionNo="+jQuery("#editAddress_popwin_versionNo").val();var x=jQuery("input[id^=editAddress_popwin_subVersionNo_]");if(x&&x.length>0){var z=jQuery("input[id^=editAddress_popwin_subVersionNo_]").map(function(){return"subVersionNos="+jQuery(this).val()
}).get().join("&");F=F+"&"+z}var r="/order/editOrderSaveAddrUserNew.do";jQuery.ajax({type:"post",url:r,data:F,success:function(a){if(a==1){var b=jQuery("#editAddress_popwin_succseTest").val();jQuery("#editAddress_popwin_ResultText").html(b)}else{if(a==2){unlockOrderAddress(D,F);jQuery("#editAddress_popwin_ResultText").html("新地址产生不同的运费，无法做修改，可以尝试取消订单重新购买，谢谢支持！")}else{if(a==3){unlockOrderAddress(D,F);jQuery("#editAddress_popwin_ResultText").html("新地址不支持当前配送服务，无法修改，可以尝试取消订单重新购买，谢谢支持！")}else{if(a==4){unlockOrderAddress(D,F);jQuery("#editAddress_popwin_ResultText").html("新地址不支持当前支付服务，无法修改，可以尝试取消订单重新购买，谢谢支持！")}else{unlockOrderAddress(D,F);jQuery("#editAddress_popwin_ResultText").html("系统异常，请重试！")}}}}jQuery(".popGeneral_address").hide();yhdLib.popwin({popcontentstr:jQuery("#editAddress_popwin_succseDiv").html()});
setTimeout(function(){window.location.reload()},3000)}})}function validateAddressPara(l,j,q,k,n,r){if(r!=1){var p=jQuery.trim(l).length;if(p==0||p>20){jQuery("#editOrderAddr_pop_receiverNameNull").show();jQuery("#editOrderAddr_pop_ReceiverName").focus();return false}if(filterScripts(l)!=l||!checkTextValid(l)){jQuery("#editOrderAddr_pop_receiverNameError").show();return false}if(q==""&&k==""){jQuery("#editOrderAddr_pop_mobilePhoneNull").show();jQuery("#editOrderAddr_pop_mobile").focus();return false}else{if(q!=""){q=jQuery.trim(q);var o=/^1\d{10,12}$/g;if(!q.match(o)){jQuery("#editOrderAddr_pop_mobileError").show();jQuery("#editOrderAddr_pop_mobile").focus();return false}}if(k!=""){k=jQuery.trim(k);var o=/^[0](\d{2,3})-(\d{7,8})(-(\d{1,6}))*$/;if(!k.match(o)){jQuery("#editOrderAddr_pop_phoneError").show();
jQuery("#editOrderAddr_pop_phone").focus();return false}}}}var m=(jQuery.trim(j)+n).length;if(j.length==0||m>68){jQuery("#editOrderAddr_pop_addressNull").show();jQuery("#editOrderAddr_pop_Address").focus();return false}if(filterScripts(j)!=j||!checkTextValid(j)){jQuery("#editOrderAddr_pop_addressError").show();return false}return true}function clearAddressDes(){jQuery("#editOrderAddr_pop_receiverNameNull").hide();jQuery("#editOrderAddr_pop_receiverNameError").hide();jQuery("#editOrderAddr_pop_addressNull").hide();jQuery("#editOrderAddr_pop_addressError").hide();jQuery("#editOrderAddr_pop_mobileError").hide();jQuery("#editOrderAddr_pop_phoneError").hide();jQuery("#editOrderAddr_pop_mobilePhoneNull").hide();jQuery("#editOrderAddr_pop_postCodeNull").hide()}function filterScripts(d){var c="";c=decodeURIComponent(d);
c=c.replace(/<script(.|\n)*\/script>\s*/ig,"").replace(/<javascript(.|\n)*\/javascript>\s*/ig,"").replace(/<[^>]+/ig,function(a){return a.replace(/\s*on\w+=[^ ]+/ig,"")});return c}function checkTextValid(f){if(f==null||f.length==0){return false}var g=/[\"\'-,.()-,.，。（）\\]/gi;var e=f.replace(g,"");e=e.replace(/\s/g,"");var h=/[\"\'<>,.\/:&*^%$#@!?\\]/;if(e==null||e.length==0){return false}else{if(h.exec(f)){return false}else{return true}}}function popWinEditOrderDiv(b){jQuery.ajax({type:"post",url:"/order/popShowEditAddressPage.do",data:"orderId="+b,success:function(a){if(a<0){YHD.alert("抱歉，您的订单不能编辑。");window.location.reload()}else{YHD.popwin(a)}}})}function openToBindMobile(){window.open("/member/bind/bind.do");jQuery(".close_tcg").click()}function alreadyPayOrderEditAddreValidate(d){var c=$("#isHaveVerify_"+d).val();
if(c==0){jQuery.ajax({type:"post",url:"/order/popShowOrderEditAddreValidate.do",data:"orderId="+d,success:function(a){if(a<0){YHD.alert("抱歉，您的订单不能编辑。");window.location.reload()}else{yhdLib.popwin({popcontentstr:a})}}})}else{popWinEditOrderDiv(d)}}var deadLine=60;function timeToDeadLine(){if(jQuery(".reg_btn_box").length>=1){if(deadLine!=0){jQuery(".reg_btn_box").html("<button class='reg_tel_btn1' disabled='disabled'><span>"+deadLine+"</span>秒后重新获取</button>");deadLine--;setTimeout("timeToDeadLine()",1000)}else{jQuery(".reg_btn_box").html("<button class='reg_tel_btn2' onclick='sendEditOrderAddrValidateCode();'>重新发送验证码</button>")}}}function clearSendCodeDesc(){jQuery("#tipsText").html("为了保证订单安全，请您在修改地址之前完成手机验证");jQuery("#tipsTextClass").addClass("tips1");jQuery("#tipsTextClass").removeClass("tips2")
}function sendEditOrderAddrValidateCode(){clearSendCodeDesc();var b="/order/sendEditOrderAddrValidateCode.do?callback=?";jQuery.getJSON(b,function(a){if(a&&a.errorNum){if(a.errorNum==1){jQuery("#tipsText").html("验证码已经发送成功！");deadLine=60;timeToDeadLine()}else{if(a.errorNum==2){jQuery("#tipsText").html("您今天尝试的次数过多，请明天再来！");jQuery("#tipsTextClass").addClass("tips2");jQuery("#tipsTextClass").removeClass("tips1")}else{if(a.errorNum==3){jQuery("#tipsText").text("两次发送短信的间隔不能小于1分钟！");jQuery("#tipsTextClass").addClass("tips2");jQuery("#tipsTextClass").removeClass("tips1")}else{if(a.errorNum==4){jQuery("#tipsText").html("系统繁忙，请稍后再试！");jQuery("#tipsTextClass").addClass("tips2");jQuery("#tipsTextClass").removeClass("tips1")}}}}}})}function verificationEditOrderAddrCode(){clearSendCodeDesc();var c=$(".reg_num").val();
if(!c||c==""){jQuery("#tipsText").html("验证码不能为空");jQuery("#tipsTextClass").addClass("tips2");jQuery("#tipsTextClass").removeClass("tips1");return}else{if(c.length!=6||!isNumber(c)){jQuery("#tipsText").html("您输入的验证码有误，验证码是6位数字");jQuery("#tipsTextClass").addClass("tips2");jQuery("#tipsTextClass").removeClass("tips1");return}else{var d="/order/validateCodeForEditOrderAddr.do?validateCode="+c+"&callback=?";jQuery.getJSON(d,function(a){if(a&&a.errorNum){if(a.errorNum==1){var b=jQuery("#pop_editOrderAddr_mobileVif_orderid").val();$("#isHaveVerify_"+b).val(1);jQuery(".close_tcg").click();popWinEditOrderDiv(b)}else{jQuery("#tipsText").html("验证码不正确");jQuery("#tipsTextClass").addClass("tips2");jQuery("#tipsTextClass").removeClass("tips1")}}})}}}function isNumber(c){var d=/^[0-9]+(.[0-9]{1,2})?$/;if(!d.exec(c)){return false
}return true}function unlockOrderAddress(d,e){var f="/order/unLockOrder.do";jQuery.ajax({type:"post",url:f,data:e,complete:function(a){window.location.reload()}})};